class Spit : ZilchComponent
{
    var Time: Real = 0;
    var Spit : Cog = null;
    var Speed : Real = 35;
    function Initialize(init : CogInitializer)
    {
        Zero.Connect(Zero.Keyboard, Events.KeyDown, this.OnKeyDown);
        Zero.Connect(this.Owner, Events.CollisionStarted,     this.OnCollisionStarted);
    }
    
    function OnKeyDown(event : KeyboardEvent)
    {
        if(event.Key == Keys.Space)
        {
            var screenPosition = Zero.Mouse.ScreenPosition;
            var mousePosition = this.LevelSettings.CameraViewport.ScreenToWorldZPlane(screenPosition, 0.0);
            var spawnPosition = this.Owner.Transform.Translation;
            var spawnDirection = mousePosition - this.Space.FindObjectByName("Player").Transform.Translation;
            spawnDirection = Math.Normalize(spawnDirection);
            spawnPosition.Z = 1;
            var archetypeToSpawn = Archetype.Spit;
            var createdObject = this.Space.CreateAtPosition(archetypeToSpawn, spawnPosition);
            createdObject.RigidBody.Velocity = spawnDirection * this.Speed;
        }
    }
    function OnCollisionStarted(event: CollisionEvent)
    {
        var otherObject = event.OtherObject;
        this.Spit = this.Space.FindObjectByName("Spit");
        if(otherObject.Name == "Player")
        {
            this.Spit.MultiConvexMeshCollider.Ghost = true;
        }
        else
        {
            this.Spit.MultiConvexMeshCollider.Ghost = false;
        }
        if(otherObject.Name == "Enemy")
        {
            var enemy = this.Space.FindObjectByName("Enemy");
            enemy.RedneckHealth.EnemyHealth;
            This.Spit.Destroy();
        }
    }
}
